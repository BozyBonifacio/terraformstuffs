resource "azurerm_storage_account" "demo" {
  name                     = "n21cmpdstg"
  resource_group_name      = azurerm_resource_group.demo.name
  location                 = azurerm_resource_group.demo.location
  account_tier             = "Standard"
  account_replication_type = "LRS"

  network_rules {
    default_action             = "Deny"
    bypass                     = ["AzureServices"] # see: https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security#exceptions
    ip_rules = ["32.66.102.170","32.66.102.171","32.66.102.172","32.66.102.173","32.66.102.174","32.66.114.161","32.66.114.162",   "32.66.114.163","32.66.114.164","32.66.114.165","32.65.74.146","32.65.74.147","32.65.74.148","32.65.74.149","32.65.74.150","158.82.143.130","158.82.159.130","202.167.233.229","27.111.213.117","41.242.168.121","52.254.79.207","52.247.126.178","52.168.82.81","52.177.0.71","52.177.116.166","89.28.187.5","89.28.187.6","89.28.187.7","89.28.187.8","89.28.187.9","89.28.187.10","89.28.187.11","89.28.187.12","158.82.143.120","158.82.159.120","152.82.1.1","152.82.1.2","152.82.1.3","152.82.1.4","152.82.1.5","152.82.1.6","152.82.1.7","152.82.1.8","152.82.1.9","152.82.1.10","152.82.1.11","152.82.1.12","152.82.1.13","152.82.1.14","152.82.1.15","152.82.1.16","152.82.1.17","152.82.1.18","152.82.1.19","152.82.1.20","152.82.1.21","152.82.1.22","152.82.1.23","152.82.1.24","152.82.1.25","152.82.1.26","152.82.1.27","152.82.1.28","152.82.1.29","152.82.1.30","152.82.1.31","152.82.1.32","152.82.1.33","152.82.1.33","152.82.1.34","152.82.1.35","152.82.1.36","152.82.1.37","152.82.1.38","152.82.1.39","152.82.1.40","152.82.1.41","152.82.1.42","152.82.1.43","152.82.1.44","152.82.1.45","152.82.1.46","104.43.166.127","40.78.156.126","23.99.177.77"]
  }

  tags = {
    "#AppID" = "003865"
    inventory = " {\"Product\":\"cmp\",\"Application\":\"cmp\",\"Environment\":\"dev\",\"Function\":\"storageaccount\"}"
  }
}

resource "azurerm_storage_container" "demo" {
  name                  = "appinsightsexport"
  storage_account_name  = azurerm_storage_account.demo.name
  container_access_type = "private"
}